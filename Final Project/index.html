<html>

<head>
  <title>Final Computer Graphics Project</title>
  <link rel="stylesheet" type="text/css" href="CSS/style.css">
</head>

<style>
  body {
    margin: 0;
  }

  canvas {
    width: 100%;
    height: 100%;
  }
</style>

<body>

  <!--include the three.js library-->
  <script src="js/three.js">
  </script>
  <!--and the trackball code-->
  <script src="js/OrbitControls.js"></script>
  <script src="js/PLYLoader.js"></script>
  <script src="js/dat.gui.min.js"></script>

  <!-- <div id="texture">
  Introduce the texture:
  <form id="texture_form">
    <select id="txt">
      <option value="img/brick_bump.jpg">Bricks</option>
      <option value="img/wood_1.jpg">Wood 1</option>
      <option value="img/wood_2.jpg">Wood 2</option>
    </select>
  </form>
  </div> -->

  <script>
    var FLOOR_WIDTH = 80; //x-axis
    var FLOOR_HEIGHT = 0.1; //y-axis
    var FLOOR_LENGTH = 110; //z-axis

    var WALL_HEIGHT = 15;
    var WALL_THICKNESS = 0.4;

    var WALL_LEFT_LENGTH = 0.65;
    var WALL_LEFT2_LENGTH = 0.45;
    var WALL_LEFT3_LENGTH = 0.2;
    var WALL_RIGHT_LENGTH = 0.8;
    var WALL_TOP_WIDTH = 0.35;

    var DOOR_THICKNESS = WALL_THICKNESS + 0.2;
    var DOOR_HEIGHT = WALL_HEIGHT*0.85;
    var DOOR_WIDTH = 6;

    var WINDOW_THICKNESS = WALL_THICKNESS + 0.08;
    var WINDOW_HEIGHT = WALL_HEIGHT * 0.55;
    var WINDOW_WIDTH = WINDOW_HEIGHT + 4;

    var WINDOW_HEIGHT_TALL = WALL_HEIGHT * 0.8;
    var WINDOW_WIDTH_TALL = WINDOW_HEIGHT_TALL - 4.5;

    var OFFSET = 0.1;

    var WallSideEnum = Object.freeze({"none":-1, "right":0, "left":1, "top":2, "bottom":3, "front":4, "back":5});

    //Create the scene
    var scene = new THREE.Scene();
    scene.background = new THREE.Color(0x93C47D);

    //Create the webgl renderer
    var renderer = new THREE.WebGLRenderer();

    renderer.setSize(window.innerWidth, window.innerHeight);

    //Add the renderer to the current document
    document.body.appendChild(renderer.domElement);

    //Camera creation
    var ratio = window.innerWidth / window.innerHeight;
    //Create the perspective camera
    var camera = new THREE.PerspectiveCamera(45, ratio, 0.1, 2000);
    camera.position.set(60, 25, 60);


    var cameraLight = new THREE.PointLight(new THREE.Color(1, 1, 1), (0.2));
    camera.add(cameraLight);

    var axesHelper = new THREE.AxesHelper(300,300,300);
    scene.add( axesHelper );

    scene.add(camera);

    var geometry_floor = new THREE.CubeGeometry(FLOOR_WIDTH, FLOOR_HEIGHT, FLOOR_LENGTH);
    var geometry_wall_parallel = new THREE.CubeGeometry(FLOOR_WIDTH-0.2, WALL_HEIGHT, WALL_THICKNESS);
    var geometry_wall_parallel_out = new THREE.CubeGeometry(FLOOR_WIDTH, WALL_HEIGHT, WALL_THICKNESS);
    var geometry_wall_parallel_02 = new THREE.CubeGeometry(FLOOR_WIDTH*0.25-3.6, WALL_HEIGHT, WALL_THICKNESS);
    var geometry_wall_parallel_03 = new THREE.CubeGeometry(FLOOR_WIDTH*WALL_TOP_WIDTH, WALL_HEIGHT, WALL_THICKNESS);
    var geometry_wall_parallel_04 = new THREE.CubeGeometry(FLOOR_WIDTH*0.434, WALL_HEIGHT, WALL_THICKNESS);
    var geometry_wall_orthogonal = new THREE.CubeGeometry(WALL_THICKNESS, WALL_HEIGHT, FLOOR_LENGTH);
    var geometry_wall_orthogonal_08 = new THREE.CubeGeometry(WALL_THICKNESS, WALL_HEIGHT, FLOOR_LENGTH*WALL_RIGHT_LENGTH);
    var geometry_wall_orthogonal_06 = new THREE.CubeGeometry(WALL_THICKNESS, WALL_HEIGHT, FLOOR_LENGTH*WALL_LEFT_LENGTH);
    var geometry_wall_orthogonal_04 = new THREE.CubeGeometry(WALL_THICKNESS, WALL_HEIGHT, FLOOR_LENGTH*WALL_LEFT2_LENGTH-0.2);
    var geometry_wall_orthogonal_02 = new THREE.CubeGeometry(WALL_THICKNESS, WALL_HEIGHT, FLOOR_LENGTH*WALL_LEFT3_LENGTH);
    var geometry_wall_diagonal = new THREE.CubeGeometry(WALL_THICKNESS, WALL_HEIGHT, FLOOR_LENGTH*0.287);

    var geometry_door = new THREE.CubeGeometry(DOOR_WIDTH, DOOR_HEIGHT, DOOR_THICKNESS);

    var geometry_window = new THREE.CubeGeometry(WINDOW_WIDTH, WINDOW_HEIGHT, WINDOW_THICKNESS);
    var geometry_window_large = new THREE.CubeGeometry(WINDOW_WIDTH * 2 - 8, WINDOW_HEIGHT, WINDOW_THICKNESS);
    var geometry_window_tall = new THREE.CubeGeometry(WINDOW_WIDTH_TALL, WINDOW_HEIGHT_TALL, WINDOW_THICKNESS);

    var rotate90Degrees = new THREE.Matrix4();
    rotate90Degrees.makeRotationY(Math.PI/2);


    function addDoors() {
      var door_bedroom = new THREE.Mesh(geometry_door, loadTexture('http://localhost:8000/img/txtr_door.png', 1, WallSideEnum.none));
      door_bedroom.applyMatrix(rotate90Degrees);
      door_bedroom.position.y+=DOOR_HEIGHT/2;
      door_bedroom.position.z+=26.5;
      door_bedroom.position.x-=FLOOR_WIDTH/2-FLOOR_WIDTH/2*(1-WALL_TOP_WIDTH) - 2;
      scene.add(door_bedroom);

      var door_toilet = new THREE.Mesh(geometry_door, loadTexture('http://localhost:8000/img/txtr_door.png', 1, WallSideEnum.none));
      door_toilet.position.y+=DOOR_HEIGHT/2;
      door_toilet.position.z+=FLOOR_LENGTH / 2 - geometry_wall_parallel.parameters.depth / 2 - FLOOR_LENGTH * 0.2;
      door_toilet.position.x-=26;
      scene.add(door_toilet);

      var door_bathroom = new THREE.Mesh(geometry_door, loadTexture('http://localhost:8000/img/txtr_door.png', 1, WallSideEnum.none));
      door_bathroom.position.y+=DOOR_HEIGHT/2;
      door_bathroom.position.z+=FLOOR_LENGTH / 2 - geometry_wall_parallel.parameters.depth / 2 - FLOOR_LENGTH * 0.2;
      door_bathroom.position.x+=2;
      scene.add(door_bathroom);

      var door_garage = new THREE.Mesh(geometry_door, loadTexture('http://localhost:8000/img/txtr_door.png', 1, WallSideEnum.none));
      door_garage.position.y+=DOOR_HEIGHT/2;
      door_garage.position.z+=FLOOR_LENGTH / 2 - geometry_wall_parallel.parameters.depth / 2 - FLOOR_LENGTH * 0.2;
      door_garage.position.x+=24;
      scene.add(door_garage);
    }

    function addWindows() {
      var mat = createTextureMaterial('http://localhost:8000/img/txtr_window.png', 1);
      mat.transparent = true;
      var materials = createMaterialsArray(mat, '', WallSideEnum.none);

      //loadTexture('http://localhost:8000/img/txtr_window.png', 1, WallSideEnum.none)

      var window_bedroom = new THREE.Mesh(geometry_window, materials);
      window_bedroom.applyMatrix(rotate90Degrees);
      window_bedroom.position.y+=WALL_HEIGHT/2 + 1.3;
      window_bedroom.position.z+=10;
      window_bedroom.position.x-=FLOOR_WIDTH/2 - geometry_wall_orthogonal.parameters.width/2;
      scene.add(window_bedroom);

      var window_toilet = new THREE.Mesh(geometry_window, loadTexture('http://localhost:8000/img/txtr_window.png', 1, WallSideEnum.none));
      window_toilet.applyMatrix(rotate90Degrees);
      window_toilet.position.y+=WALL_HEIGHT/2 + 1.3;
      window_toilet.position.z+=45;
      window_toilet.position.x-=FLOOR_WIDTH/2 - geometry_wall_orthogonal.parameters.width/2;
      scene.add(window_toilet);

      var window_toilet2 = new THREE.Mesh(geometry_window, loadTexture('http://localhost:8000/img/txtr_window.png', 1, WallSideEnum.none));
      window_toilet2.position.y+=WALL_HEIGHT/2 + 1.3;
      window_toilet2.position.z+=FLOOR_LENGTH / 2 - geometry_wall_parallel.parameters.depth / 2;
      window_toilet2.position.x-=30;
      scene.add(window_toilet2);

      var window_bathroom = new THREE.Mesh(geometry_window_large, loadTexture('http://localhost:8000/img/txtr_window_large.png', 1, WallSideEnum.none));
      window_bathroom.position.y+=WALL_HEIGHT/2 + 1.3;
      window_bathroom.position.z+=FLOOR_LENGTH / 2 - geometry_wall_parallel.parameters.depth / 2;
      scene.add(window_bathroom);

      var window_kitchen = new THREE.Mesh(geometry_window_large, loadTexture('http://localhost:8000/img/txtr_window_large.png', 1, WallSideEnum.none));
      window_kitchen.applyMatrix(rotate90Degrees);
      window_kitchen.position.y+=WALL_HEIGHT/2 + 1.3;
      window_kitchen.position.z+=15;
      window_kitchen.position.x+=FLOOR_WIDTH / 2 - geometry_wall_orthogonal.parameters.width / 2;
      scene.add(window_kitchen);

      var window_livingroom = new THREE.Mesh(geometry_window_tall, loadTexture('http://localhost:8000/img/txtr_window_tall.png', 1, WallSideEnum.none));
      window_livingroom.applyMatrix(rotate90Degrees);
      window_livingroom.position.y+=WALL_HEIGHT/2;
      window_livingroom.position.z-=15;
      window_livingroom.position.x+=FLOOR_WIDTH / 2 - geometry_wall_orthogonal.parameters.width / 2;
      scene.add(window_livingroom);
    }

    var floor = new THREE.Mesh(geometry_floor, loadTexture('http://localhost:8000/img/txtr_floor.jpg', 5, WallSideEnum.none));
    scene.add(floor);

    buildWalls();
    addDoors();
    addWindows();
    addLighting();

    //Resizing function -> adjust cube position and size to the window size
    var MyResize = function() {
      var width = window.innerWidth;
      var height = window.innerHeight;
      //Update renderer size
      renderer.setSize(width, height);
      //Update camera aspect ratio
      camera.aspect = width / height;
      //Update projection matrix from the new values
      camera.updateProjectionMatrix();
      //Render the scene again
      renderer.render(scene, camera);
    }

    controls = new THREE.OrbitControls(camera);

    //Updating function
    var MyUpdateLoop = function() {
      controls.update();
      //Call the render with the scene and the camera
      renderer.render(scene, camera);
      //Finally perform a recursive call to update again
      //This must be called because the mouse changes the camera position
      requestAnimationFrame(MyUpdateLoop);
    };

    requestAnimationFrame(MyUpdateLoop);
    var render = function() {
      requestAnimationFrame(render);
      renderer.render(scene, camera);
    };


    function loadTexture(uri, rep, outsideWall) {
      return createMaterialsArray(createTextureMaterial(uri, rep), 'http://localhost:8000/img/txtr_brick_brown_light.jpg', outsideWall);
    }

    function createMaterialsArray(baseMaterial, specialTexture, side) {
      var materials = [
        baseMaterial, // Right side 0
        baseMaterial, // Left side 1
        baseMaterial, // Top side 2
        baseMaterial, // Bottom side 3
        baseMaterial, // Front side 4
        baseMaterial  // Back side 5
      ];
      if (side != WallSideEnum.none)
        materials[side] = createTextureMaterial(specialTexture, 8);
      return materials;
    }

    function createTextureMaterial(uri, repeats) {
      THREE.ImageUtils.crossOrigin = true;
      var texture = new THREE.TextureLoader().load(uri);
      texture.crossOrigin = true;
      texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
      texture.repeat.set(repeats, repeats);
      var material = new THREE.MeshLambertMaterial({
        map: texture
      });
      return material;
    }


    /*---------------------Addition of all models to the scene--------------------*/

	//Bedroom
    //Bed model

    var bed_color = new THREE.Color(1, 1, 1);
    var bed_material = new THREE.MeshPhongMaterial();

    bed_material.color = bed_color;
    bed_material.shininess = 0;

    var loader = new THREE.PLYLoader();
    var bed_mesh = null;
    loader.load('Final Models/Bed1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(25 / size.length(), 25 / size.length(), 25 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);

      combined.multiply(tra);
      combined.multiply(sca);

      bed_mesh = new THREE.Mesh(geometry, bed_material);

      bed_mesh.applyMatrix(sca);
      bed_mesh.name = "loaded_mesh";
      bed_mesh.position.x -= FLOOR_WIDTH/3;
      bed_mesh.position.z -= FLOOR_LENGTH/2-FLOOR_LENGTH*(1-WALL_LEFT_LENGTH)-2.5;

      bed_mesh.castShadow = true;
      scene.add(bed_mesh);
    });

	  //Lamp_1 bedroom model

    var lamp_color_1 = new THREE.Color(1, 0.8, 0);
    var lamp_material_1 = new THREE.MeshPhongMaterial();

    lamp_material_1.color = lamp_color_1;
    lamp_material_1.shininess = 100;

    var loader8 = new THREE.PLYLoader();
    var lamp_mesh_1 = null;
    loader8.load('Final Models/lamp1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(17 / size.length(), 17 / size.length(), 17 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);

      combined.multiply(tra);
      combined.multiply(sca);

      lamp_mesh_1 = new THREE.Mesh(geometry, lamp_material_1);

      lamp_mesh_1.applyMatrix(sca);
      lamp_mesh_1.name = "loaded_mesh_8";

      lamp_mesh_1.position.x -= FLOOR_WIDTH/3+6;
      lamp_mesh_1.position.y += 5;

      lamp_mesh_1.castShadow = true;
      scene.add(lamp_mesh_1);
    });

    //treasurechest2 bedroom Model
    var treasurechest2_color = new THREE.Color(0.6, 0.3, 0.2);
    var treasurechest2_material = new THREE.MeshPhongMaterial();

   treasurechest2_material.color = treasurechest2_color;
    treasurechest2_material.shininess = 0;

     var loaderN= new THREE.PLYLoader();
     var treasurechest2_mesh = null;
     loaderN.load('Final Models/treasurechest.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(11 / size.length(), 11 / size.length(), 11 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(2*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

      treasurechest2_mesh = new THREE.Mesh(geometry, treasurechest2_material);

   	treasurechest2_mesh.applyMatrix(sca);

      treasurechest2_mesh.applyMatrix(rot);
      treasurechest2_mesh.name = "loaded_mesh_N";

      treasurechest2_mesh.position.x -= 27;
      treasurechest2_mesh.position.z += 4;

      treasurechest2_mesh.castShadow = true;
      scene.add(treasurechest2_mesh);
    });

    //nightstand1 bedroom Model
    var nightstand1_color = new THREE.Color(0.6, 0.3, 0.2);
    var nightstand1_material = new THREE.MeshPhongMaterial();

     nightstand1_material.color = nightstand1_color;
     nightstand1_material.shininess = 0;

     var loaderS= new THREE.PLYLoader();
     var nightstand1_mesh = null;
     loaderS.load('Final Models/nightstand1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(9/ size.length(), 9/ size.length(), 9/ size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(2*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

      nightstand1_mesh = new THREE.Mesh(geometry, nightstand1_material);

   	nightstand1_mesh.applyMatrix(sca);

      nightstand1_mesh.applyMatrix(rot);
      nightstand1_mesh.name = "loaded_mesh_S";

      nightstand1_mesh.position.x -= 16;
      nightstand1_mesh.position.z += -13.5;

      nightstand1_mesh.castShadow = true;
      scene.add(nightstand1_mesh);
    });

    //nightstand2 bedroom Model
    var nightstand2_color = new THREE.Color(0.6, 0.3, 0.2);
    var nightstand2_material = new THREE.MeshPhongMaterial();

    nightstand2_material.color = nightstand2_color;
    nightstand2_material.shininess = 0;

     var loaderT= new THREE.PLYLoader();
     var nightstand2_mesh = null;
     loaderT.load('Final Models/nightstand1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(9/ size.length(), 9/ size.length(), 9/ size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(2*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

      nightstand2_mesh = new THREE.Mesh(geometry, nightstand2_material);

   	nightstand2_mesh.applyMatrix(sca);

      nightstand2_mesh.applyMatrix(rot);
      nightstand2_mesh.name = "loaded_mesh_T";

      nightstand2_mesh.position.x -= 36.5;
      nightstand2_mesh.position.z -= 13.5;

      nightstand2_mesh.castShadow = true;
      scene.add(nightstand2_mesh);
    });

    //bookshelf2 bedroom model

    var bookshelf2_color = new THREE.Color(0.6, 0.3, 0.2);
    var bookshelf2_material = new THREE.MeshPhongMaterial();

    bookshelf2_material.color = bookshelf2_color;
    bookshelf2_material.shininess = 0;

    var loaderU = new THREE.PLYLoader();
    var bookshelf2_mesh = null;
    loaderU.load('Final Models/shelf2.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(21.5/ size.length(), 21.5/ size.length(), 21.5/ size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);

      combined.multiply(tra);
      combined.multiply(sca);

      bookshelf2_mesh = new THREE.Mesh(geometry, bookshelf2_material);

      bookshelf2_mesh.applyMatrix(sca);
      bookshelf2_mesh.name = "loaded_mesh_U";
      bookshelf2_mesh.position.x +=125;
      bookshelf2_mesh.position.z +=21;

      bookshelf2_mesh.castShadow = true;
      scene.add(bookshelf2_mesh);
    });


    //Extraroom
     //bookshelf model

    var bookshelf_color = new THREE.Color(0.6, 0.3, 0.2);
    var bookshelf_material = new THREE.MeshPhongMaterial();

    bookshelf_material.color = bookshelf_color;
    bookshelf_material.shininess = 0;

    var loaderO = new THREE.PLYLoader();
    var bookshelf_mesh = null;
    loaderO.load('Final Models/bookshelf2.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
	var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(23 / size.length(), 23 / size.length(), 23/ size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
	rot.makeRotationY(3*Math.PI/2);

      combined.multiply(tra);
      combined.multiply(sca);


      bookshelf_mesh = new THREE.Mesh(geometry, bookshelf_material);

      bookshelf_mesh.applyMatrix(sca);
	bookshelf_mesh.applyMatrix(rot);
      bookshelf_mesh.name = "loaded_mesh_O";
      bookshelf_mesh.position.x -= 20.7;
      bookshelf_mesh.position.z += 33.7;
	bookshelf_mesh.position.y += 1;


      bookshelf_mesh.castShadow = true;
      scene.add(bookshelf_mesh);
    });

	//fancychair1 model

    var fancychair1_color= new THREE.Color(1, 0.647, 0);
    var fancychair1_material = new THREE.MeshPhongMaterial();

    fancychair1_material.color = fancychair1_color;
    fancychair1_material.shininess = 0;

    var loaderP = new THREE.PLYLoader();
    var fancychair1_mesh = null;
    loaderP.load('Final Models/fancychair1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
	var rot1 = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(12/ size.length(), 12 / size.length(), 12 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
	rot1.makeRotationX(3*Math.PI/2);
      rot.makeRotationY(0.5*Math.PI-100);

      combined.multiply(tra);
      combined.multiply(sca);

      fancychair1_mesh= new THREE.Mesh(geometry, fancychair1_material);

      fancychair1_mesh.applyMatrix(sca);
	fancychair1_mesh.applyMatrix(rot1);
      fancychair1_mesh.applyMatrix(rot);
      fancychair1_mesh.name = "loaded_mesh_P";

      fancychair1_mesh.position.x -= 35;
	fancychair1_mesh.position.z+= 51;

      fancychair1_mesh.castShadow = true;
      scene.add(fancychair1_mesh);
    });

    //fancychair2 model

    var fancychair2_color= new THREE.Color(1, 0.647, 0);
    var fancychair2_material = new THREE.MeshPhongMaterial();

    fancychair2_material.color = fancychair2_color;
    fancychair2_material.shininess = 0;

      var loaderQ = new THREE.PLYLoader();
      var fancychair2_mesh= null;
      loaderQ.load('Final Models/fancychair1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
	var rot1 = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(13 / size.length(), 13 / size.length(), 13 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
	rot1.makeRotationX(3*Math.PI/2);
      rot.makeRotationY(0.5*Math.PI+100);

      combined.multiply(tra);
      combined.multiply(sca);

      fancychair2_mesh= new THREE.Mesh(geometry, fancychair2_material);

      fancychair2_mesh.applyMatrix(sca);
	fancychair2_mesh.applyMatrix(rot1);
      fancychair2_mesh.applyMatrix(rot);
      fancychair2_mesh.name = "loaded_mesh_Q";

      fancychair2_mesh.position.x -= 35;
	fancychair2_mesh.position.z+= 38;

      fancychair2_mesh.castShadow = true;
      scene.add(fancychair2_mesh);
    });

     //smalltable extra room model

    var smalltable_color= new THREE.Color(1, 1, 1);
    var smalltable_material = new THREE.MeshPhongMaterial();

    smalltable_material.color = smalltable_color;
    smalltable_material.shininess = 0;

      var loaderR = new THREE.PLYLoader();
      var smalltable_mesh= null;
      loaderR.load('Final Models/smalltable2.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(11/ size.length(), 11/ size.length(), 11/ size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

      smalltable_mesh= new THREE.Mesh(geometry, smalltable_material);

       smalltable_mesh.applyMatrix(sca);
      smalltable_mesh.applyMatrix(rot);
      smalltable_mesh.name = "loaded_mesh_R";

      smalltable_mesh.position.x -= 28;
	smalltable_mesh.position.z+= 44.5;

      smalltable_mesh.castShadow = true;
      scene.add(smalltable_mesh);
    });




    //Car model

    var car_color = new THREE.Color(0.6,0,0);
    var car_material = new THREE.MeshPhongMaterial();

    car_material.color = car_color;
    car_material.shininess = 0;

    var loader1 = new THREE.PLYLoader();
    var car_mesh = null;
    loader1.load('Final Models/car1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(24/ size.length(), 24/ size.length(), 24/ size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);

      combined.multiply(tra);
      combined.multiply(sca);

      car_mesh = new THREE.Mesh(geometry, car_material);

      car_mesh.applyMatrix(sca);
      car_mesh.name = "loaded_mesh_1";

      car_mesh.position.x += FLOOR_WIDTH/3+2.5;
      car_mesh.position.y += 1.8;
      car_mesh.position.z += FLOOR_LENGTH/2 - geometry_wall_parallel.parameters.depth/2 - (FLOOR_LENGTH*0.2)/2 +0.5;

      car_mesh.castShadow = true;
      scene.add(car_mesh);
    });


    //Shelf model

    var shelf_color = new THREE.Color(0.6, 0.3, 0.2);
    var shelf_material = new THREE.MeshPhongMaterial();

    shelf_material.color = shelf_color;
    shelf_material.shininess = 0;

    var loader2 = new THREE.PLYLoader();
    var shelf_mesh = null;
    loader2.load('Final Models/shelf1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(40 / size.length(), 40 / size.length(), 40 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);

      combined.multiply(tra);
      combined.multiply(sca);

      shelf_mesh = new THREE.Mesh(geometry, shelf_material);

      shelf_mesh.applyMatrix(sca);
      shelf_mesh.name = "loaded_mesh_2";
      shelf_mesh.position.x -= FLOOR_WIDTH/3-FLOOR_WIDTH/3 + 4;
      shelf_mesh.position.z -= FLOOR_LENGTH/2*(1-WALL_LEFT_LENGTH) - FLOOR_LENGTH*0.1 - 10.45;


      shelf_mesh.castShadow = true;
      scene.add(shelf_mesh);
    });

     //Kitchen
    //Fridge model

    var fridge_color = new THREE.Color(1, 1, 1);
    var fridge_material = new THREE.MeshPhongMaterial();

    fridge_material.color = fridge_color;
    fridge_material.shininess = 0;

    var loader3 = new THREE.PLYLoader();
    var fridge_mesh = null;
    loader3.load('Final Models/fridge1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(15 / size.length(), 15 / size.length(), 15 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(2*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

      fridge_mesh = new THREE.Mesh(geometry, fridge_material);

      fridge_mesh.applyMatrix(sca);
      fridge_mesh.applyMatrix(rot);
      fridge_mesh.name = "loaded_mesh_3";

      fridge_mesh.position.x -= -36.4;
      fridge_mesh.position.z -= 0.8;

      fridge_mesh.castShadow = true;
      scene.add(fridge_mesh);
    });

  //dishwasher model

    var dishwasher_color = new THREE.Color(0.5,0.5,0.5);
    var dishwasher_material = new THREE.MeshPhongMaterial();

    dishwasher_material.color = dishwasher_color;
    dishwasher_material.shininess = 0;

    var loaderA = new THREE.PLYLoader();
    var dishwasher_mesh = null;
    loaderA.load('Final Models/dishwasher1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(10.2 / size.length(), 10.2 / size.length(), 10.2 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(3*Math.PI/2);

      combined.multiply(tra);
      combined.multiply(sca);

      dishwasher_mesh = new THREE.Mesh(geometry, dishwasher_material);

      dishwasher_mesh.applyMatrix(sca);
      dishwasher_mesh.applyMatrix(rot);
      dishwasher_mesh.name = "loaded_mesh_A";

      dishwasher_mesh.position.x -= -37.4;
      dishwasher_mesh.position.z -= -24;

      dishwasher_mesh.castShadow = true;
      scene.add(dishwasher_mesh);
    });

    //sink model

    var sink_color = new THREE.Color(0.5,0.5,0.5);
    var sink_material = new THREE.MeshPhongMaterial();

    sink_material.color = sink_color;
    sink_material.shininess = 0;

    var loaderB = new THREE.PLYLoader();
    var sink_mesh = null;
    loaderB.load('Final Models/sink1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(13 / size.length(), 13 / size.length(), 13 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
     // rot.makeRotationY(-3*Math.PI/2);

      combined.multiply(tra);
      combined.multiply(sca);

      sink_mesh = new THREE.Mesh(geometry, sink_material);

     sink_mesh.applyMatrix(sca);

     // sink_mesh.applyMatrix(rot);
      sink_mesh.name = "loaded_mesh_B";

      sink_mesh.position.x -= -28.2;
      sink_mesh.position.z -= 1.5;

      sink_mesh.castShadow = true;
      scene.add(sink_mesh);
    });

     //stove model

    var stove_color = new THREE.Color(0.5,0.5,0.5);
    var stove_material = new THREE.MeshPhongMaterial();

    stove_material.color = stove_color;
   stove_material.shininess = 0;

    var loaderC = new THREE.PLYLoader();
    var stove_mesh = null;
    loaderC.load('Final Models/stove1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(11 / size.length(), 11 / size.length(), 11 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(1.5*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

      stove_mesh = new THREE.Mesh(geometry, stove_material);

     stove_mesh.applyMatrix(sca);

     stove_mesh.applyMatrix(rot);
     stove_mesh.name = "loaded_mesh_C";

      stove_mesh.position.x -= -36.8;
     stove_mesh.position.z -= -13.5;

      stove_mesh.castShadow = true;
      scene.add(stove_mesh);
    });

    //aboveoven1 model

    var aboveoven1_color = new THREE.Color(0.5,0.5,0.5);
    var aboveoven1_material = new THREE.MeshPhongMaterial();

    aboveoven1_material.color = aboveoven1_color;
   aboveoven1_material.shininess = 0;

    var loaderZ = new THREE.PLYLoader();
    var aboveoven1_mesh = null;
    loaderZ.load('Final Models/aboveoven1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
	var rot1 = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(8/ size.length(), 8 / size.length(), 8/ size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
	rot1.makeRotationX(3*Math.PI/2);
	rot.makeRotationY(1.5*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

      aboveoven1_mesh = new THREE.Mesh(geometry, aboveoven1_material);

     aboveoven1_mesh.applyMatrix(sca);
     aboveoven1_mesh.applyMatrix(rot1);
     aboveoven1_mesh.applyMatrix(rot);
     aboveoven1_mesh.name = "loaded_mesh_Z";

     aboveoven1_mesh.position.x +=38 ;
     aboveoven1_mesh.position.z +=13.5;
     aboveoven1_mesh.position.y +=10;

      aboveoven1_mesh.castShadow = true;
      scene.add(aboveoven1_mesh);
    });

	 //cabinet1 model

      var cabinet1_color = new THREE.Color(0.5,0.5,0.5);
      var cabinet1_material = new THREE.MeshPhongMaterial();

      cabinet1_material.color = cabinet1_color;
      cabinet1_material.shininess = 0;

      var loaderD= new THREE.PLYLoader();
      var cabinet1_mesh = null;
      loaderD.load('Final Models/cabinet1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(10 / size.length(), 10/ size.length(), 10 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(1.5*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

      cabinet1_mesh = new THREE.Mesh(geometry, cabinet1_material);

      cabinet1_mesh.applyMatrix(sca);

      cabinet1_mesh.applyMatrix(rot);
      cabinet1_mesh.name = "loaded_mesh_D";

      cabinet1_mesh.position.x -= -36.7;
      cabinet1_mesh.position.z -=-29.9;

      cabinet1_mesh.castShadow = true;
      scene.add(cabinet1_mesh);
    });

     //cabinet2 model

    var cabinet2_color = new THREE.Color(0.5,0.5,0.5);
    var cabinet2_material = new THREE.MeshPhongMaterial();

    cabinet2_material.color = cabinet2_color;
    cabinet2_material.shininess = 0;

     var loaderE= new THREE.PLYLoader();
     var cabinet2_mesh = null;
     loaderE.load('Final Models/cabinet2.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(10 / size.length(), 10 / size.length(), 10 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(1.5*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

      cabinet2_mesh = new THREE.Mesh(geometry, cabinet2_material);

     cabinet2_mesh.applyMatrix(sca);

     cabinet2_mesh.applyMatrix(rot);
     cabinet2_mesh.name = "loaded_mesh_E";

      cabinet2_mesh.position.x -=  -36.7;
      cabinet2_mesh.position.z -= -18.9;

      cabinet2_mesh.castShadow = true;
      scene.add(cabinet2_mesh);
    });

    //Bathroom
    //bathtube1 Model

    var bathtube1_color = new THREE.Color(0, 0.75, 0.65);
    var bathtube1_material = new THREE.MeshPhongMaterial();

    bathtube1_material.color = bathtube1_color;
    bathtube1_material.shininess = 0;

     var loaderF= new THREE.PLYLoader();
     var bathtube1_mesh = null;
     loaderF.load('Final Models/bathtube1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(20 / size.length(), 20 / size.length(), 20 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(1.5*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

      bathtube1_mesh = new THREE.Mesh(geometry, bathtube1_material);

     bathtube1_mesh.applyMatrix(sca);

     bathtube1_mesh.applyMatrix(rot);
     bathtube1_mesh.name = "loaded_mesh_F";

      bathtube1_mesh.position.x -=  -14;
     bathtube1_mesh.position.z -= -44;

      bathtube1_mesh.castShadow = true;
      scene.add(bathtube1_mesh);
    });

    //sink3 Model
    var sink3_color = new THREE.Color(0.5,0.5,0.5);
    var sink3_material = new THREE.MeshPhongMaterial();

    sink3_material.color = sink3_color;
    sink3_material.shininess = 0;

     var loaderG= new THREE.PLYLoader();
     var sink3_mesh = null;
     loaderG.load('Final Models/sink3.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
	var rot1 = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(16 / size.length(), 16 / size.length(), 16 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
	rot1.makeRotationX(3*Math.PI/2);
      rot.makeRotationY(Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

       sink3_mesh = new THREE.Mesh(geometry, sink3_material);

     sink3_mesh.applyMatrix(sca);

    sink3_mesh.applyMatrix(rot1);
    sink3_mesh.applyMatrix(rot);
     sink3_mesh.name = "loaded_mesh_G";

      sink3_mesh.position.x -= 0;
     sink3_mesh.position.z -= -50.5;

      sink3_mesh.castShadow = true;
      scene.add(sink3_mesh);
    });

    //toilet1 Model
    var toilet1_color = new THREE.Color(1, 1, 1);
    var toilet1_material = new THREE.MeshPhongMaterial();

    toilet1_material.color = toilet1_color;
    toilet1_material.shininess = 0;

     var loaderH= new THREE.PLYLoader();
     var toilet1_mesh = null;
     loaderH.load('Final Models/toilet1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
	var rot1 = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(13/ size.length(), 13/ size.length(), 13/ size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot1.makeRotationX(3*Math.PI/2);
	rot.makeRotationY(2.5*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

       toilet1_mesh = new THREE.Mesh(geometry, toilet1_material);

     toilet1_mesh.applyMatrix(sca);

     toilet1_mesh.applyMatrix(rot1);
     toilet1_mesh.applyMatrix(rot);
     toilet1_mesh.name = "loaded_mesh_H";

      toilet1_mesh.position.x -=  16.7;
      toilet1_mesh.position.z -= -53;

      toilet1_mesh.castShadow = true;
      scene.add(toilet1_mesh);
    });

    //treasurechest bathroom Model
    var treasurechest_color = new THREE.Color(0.6, 0.3, 0.2);
    var treasurechest_material = new THREE.MeshPhongMaterial();

   treasurechest_material.color = treasurechest_color;
    treasurechest_material.shininess = 0;

     var loaderI= new THREE.PLYLoader();
     var treasurechest_mesh = null;
     loaderI.load('Final Models/treasurechest.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(11 / size.length(), 11 / size.length(), 11 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(1.5*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

       treasurechest_mesh = new THREE.Mesh(geometry, treasurechest_material);

     treasurechest_mesh.applyMatrix(sca);

   treasurechest_mesh.applyMatrix(rot);
    treasurechest_mesh.name = "loaded_mesh_I";

      treasurechest_mesh.position.x -= 17.3;
     treasurechest_mesh.position.z -= -37.5;

      treasurechest_mesh.castShadow = true;
      scene.add(treasurechest_mesh);
    });

    //carpet1 Model
    var carpet1_color = new THREE.Color(0,1,1);
    var carpet1_material = new THREE.MeshPhongMaterial();

   carpet1_material.color = carpet1_color;
   carpet1_material.shininess = 0;

     var loaderJ= new THREE.PLYLoader();
     var carpet1_mesh = null;
     loaderJ.load('Final Models/carpet1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(17 / size.length(), 17/ size.length(), 17/ size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(1.5*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

       carpet1_mesh = new THREE.Mesh(geometry, carpet1_material);

     carpet1_mesh.applyMatrix(sca);

   carpet1_mesh.applyMatrix(rot);
    carpet1_mesh.name = "loaded_mesh_J";

      carpet1_mesh.position.x -= -0.4;
    carpet1_mesh.position.z -= -44 ;

      carpet1_mesh.castShadow = true;
      scene.add(carpet1_mesh);
    });

     //carpet2 Model
    var carpet2_color = new THREE.Color(0,1,1);
    var carpet2_material = new THREE.MeshPhongMaterial();

   carpet2_material.color = carpet2_color;
   carpet2_material.shininess = 0;

     var loaderK= new THREE.PLYLoader();
     var carpet2_mesh = null;
     loaderK.load('Final Models/carpet1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(8 / size.length(), 8/ size.length(), 8/ size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(1.5*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

       carpet2_mesh = new THREE.Mesh(geometry, carpet2_material);

     carpet2_mesh.applyMatrix(sca);

   carpet2_mesh.applyMatrix(rot);
    carpet2_mesh.name = "loaded_mesh_K";

      carpet2_mesh.position.x -= 17;
    carpet2_mesh.position.z -= -48 ;

      carpet2_mesh.castShadow = true;
      scene.add(carpet2_mesh);
    });

    //lampbathroom model

    var lampbathroom_color = new THREE.Color(1, 0.8, 0);
    var lampbathroom_material = new THREE.MeshPhongMaterial();

    lampbathroom_material.color = lampbathroom_color;
    lampbathroom_material.shininess = 100;

    var loaderL = new THREE.PLYLoader();
    var lampbathroom_mesh = null;
    loaderL.load('Final Models/lamp1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(17 / size.length(), 17 / size.length(), 17 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);

      combined.multiply(tra);
      combined.multiply(sca);

      lampbathroom_mesh = new THREE.Mesh(geometry, lampbathroom_material);

      lampbathroom_mesh.applyMatrix(sca);
      lampbathroom_mesh.name = "loaded_mesh_L";

      lampbathroom_mesh.position.x += -8;
      lampbathroom_mesh.position.y += 5;
	lampbathroom_mesh.position.z +=43;


      lampbathroom_mesh.castShadow = true;
      scene.add(lampbathroom_mesh);
    });

     //clothesrack1 Model
    var clothesrack1_color = new THREE.Color(0.6, 0.3, 0.2);
    var clothesrack1_material = new THREE.MeshPhongMaterial();

   clothesrack1_material.color = clothesrack1_color;
   clothesrack1_material.shininess = 0;

     var loaderM= new THREE.PLYLoader();
     var clothesrack1_mesh = null;
     loaderM.load('Final Models/clothesrack1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(13 / size.length(), 13/ size.length(), 13/ size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(1.5*Math.PI);

      combined.multiply(tra);
      combined.multiply(sca);

       clothesrack1_mesh = new THREE.Mesh(geometry, clothesrack1_material);

     clothesrack1_mesh.applyMatrix(sca);

   clothesrack1_mesh.applyMatrix(rot);
    clothesrack1_mesh.name = "loaded_mesh_M";

      clothesrack1_mesh.position.x -= -8;
    clothesrack1_mesh.position.z -= -36 ;

      clothesrack1_mesh.castShadow = true;
      scene.add(clothesrack1_mesh);
    });

    //Lamp model

    var lamp_color = new THREE.Color(1, 0.8, 0);
    var lamp_material = new THREE.MeshPhongMaterial();

    lamp_material.color = lamp_color;
    lamp_material.shininess = 100;

    var loader4 = new THREE.PLYLoader();
    var lamp_mesh = null;
    loader4.load('Final Models/lamp1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(17 / size.length(), 17 / size.length(), 17 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);

      combined.multiply(tra);
      combined.multiply(sca);

      lamp_mesh = new THREE.Mesh(geometry, lamp_material);

      lamp_mesh.applyMatrix(sca);
      lamp_mesh.name = "loaded_mesh_4";

      lamp_mesh.position.x += 2;
      lamp_mesh.position.y += 5;

      lamp_mesh.castShadow = true;
      scene.add(lamp_mesh);
    });

    //Table model

    var table_color = new THREE.Color(0, 0.75, 0.65);
    var table_material = new THREE.MeshPhongMaterial();

    table_material.color = table_color;
    table_material.shininess = 0;

    var loader5 = new THREE.PLYLoader();
    var table_mesh = null;
    loader5.load('Final Models/tablestyle1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(17 / size.length(), 17 / size.length(), 17 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(-Math.PI/2);

      combined.multiply(tra);
      combined.multiply(sca);

      table_mesh = new THREE.Mesh(geometry, table_material);

      table_mesh.applyMatrix(sca);
      table_mesh.applyMatrix(rot);
      table_mesh.name = "loaded_mesh_5";

      table_mesh.position.x += 10;
	table_mesh.position.z += 15;
      table_mesh.position.y += 0.05;


      table_mesh.castShadow = true;
      scene.add(table_mesh);
    });

    //Chair model

    var chair_color_1 = new THREE.Color(1, 1, 1);
    var chair_material_1 = new THREE.MeshPhongMaterial();

    chair_material_1.color = chair_color_1;
    chair_material_1.shininess = 0;

    //Chair 1

    var loader6 = new THREE.PLYLoader();
    var chair_mesh_1 = null;
    loader6.load('Final Models/chair1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(10 / size.length(), 10 / size.length(), 10 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(-Math.PI/2);

      combined.multiply(tra);
      combined.multiply(sca);

      chair_mesh_1 = new THREE.Mesh(geometry, chair_material_1);

      chair_mesh_1.applyMatrix(sca);
      chair_mesh_1.applyMatrix(rot);
      chair_mesh_1.name = "loaded_mesh_6";

      chair_mesh_1.position.x += 2.9;
	chair_mesh_1.position.z+= 14;

      chair_mesh_1.castShadow = true;
      scene.add(chair_mesh_1);
    });

    //Chair 2

    var chair_color_2 = new THREE.Color(1, 1, 1);
    var chair_material_2 = new THREE.MeshPhongMaterial();

    chair_material_2.color = chair_color_2;
    chair_material_2.shininess = 0;

    var loader7 = new THREE.PLYLoader();
    var chair_mesh_2 = null;
    loader7.load('Final Models/chair1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(10 / size.length(), 10 / size.length(), 10 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(Math.PI/2);

      combined.multiply(tra);
      combined.multiply(sca);

      chair_mesh_2 = new THREE.Mesh(geometry, chair_material_2);

      chair_mesh_2.applyMatrix(sca);
      chair_mesh_2.applyMatrix(rot);
      chair_mesh_2.name = "loaded_mesh_7";

      chair_mesh_2.position.x += 13;
	chair_mesh_2.position.z += 14;

      chair_mesh_2.castShadow = true;
      scene.add(chair_mesh_2);
    });


    //Television model

    var tv_color = new THREE.Color(0.5, 0.5, 0.5);
    var tv_material = new THREE.MeshPhongMaterial();

    tv_material.color = tv_color;
    tv_material.shininess = 10;

    var loader9 = new THREE.PLYLoader();
    var tv_mesh = null;
    loader9.load('Final Models/tv.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(20 / size.length(), 20 / size.length(), 20 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);

      combined.multiply(tra);
      combined.multiply(sca);
      rot.makeRotationX(-Math.PI/2);

      tv_mesh = new THREE.Mesh(geometry, tv_material);

      tv_mesh.applyMatrix(sca);
      tv_mesh.applyMatrix(rot);
      tv_mesh.name = "loaded_mesh_9";

      tv_mesh.position.z -= FLOOR_LENGTH/2 - geometry_wall_parallel.parameters.depth/2 - 2;

      tv_mesh.castShadow = true;
      scene.add(tv_mesh);
    });

    //Painting model

    var painting_color = new THREE.Color(0.8, 0.5, 0.8);
    var painting_material = new THREE.MeshPhongMaterial();

    painting_material.color = painting_color;
    painting_material.shininess = 0;

    var loader10 = new THREE.PLYLoader();
    var painting_mesh = null;
    loader10.load('Final Models/painting1.ply', function(geometry) {
      geometry.computeVertexNormals();
      geometry.computeBoundingBox();

      var center = geometry.boundingBox.getCenter();
      var size = geometry.boundingBox.getSize();

      var sca = new THREE.Matrix4();
      var tra = new THREE.Matrix4();
      var rot = new THREE.Matrix4();
      var combined = new THREE.Matrix4();

      sca.makeScale(20 / size.length(), 20 / size.length(), 20 / size.length());
      tra.makeTranslation (-center.x,-center.y,-center.z);
      rot.makeRotationY(0.8);

      combined.multiply(tra);
      combined.multiply(sca);

      painting_mesh = new THREE.Mesh(geometry, painting_material);

      painting_mesh.applyMatrix(sca);
      painting_mesh.applyMatrix(rot);
      painting_mesh.name = "loaded_mesh_10";

      painting_mesh.position.x-=FLOOR_WIDTH/2-FLOOR_WIDTH/2*(1-WALL_TOP_WIDTH) + 13.75 ;
      painting_mesh.position.z-=FLOOR_LENGTH/2 - geometry_wall_parallel.parameters.depth/2 - (FLOOR_LENGTH*0.2)/2 + OFFSET;

      painting_mesh.castShadow = true;
      scene.add(painting_mesh);
    });





/*---------------------Selector of models in the scene--------------------*/

    var raycaster = new THREE.Raycaster();

    //Boolean variables of each of the items

    var selectedObj_bed = false;
    var selectedObj_car = false;
    var selectedObj_shelf = false;
    var selectedObj_bookshelf= false;
    var selectedObj_bookshelf2= false;
    var selectedObj_fridge = false;
    var selectedObj_lamp = false;
    var selectedObj_dishwasher= false;
    var selectedObj_sink= false;
    var selectedObj_stove= false;
    var selectedObj_table = false;
    var selectedObj_smalltable = false;
    var selectedObj_chair_1 = false;
    var selectedObj_chair_2 = false;
    var selectedObj_fancychair1 = false;
    var selectedObj_fancychair2 = false;
    var selectedObj_lamp_1 = false;
    var selectedObj_tv = false;
    var selectedObj_painting = false;
    var selectedObj_cabinet1=false;
    var selectedObj_cabinet2=false;
    var selectedObj_aboveoven1=false;
    var selectedObj_bathtube1=false;
    var selectedObj_toilet1=false;
    var selectedObj_sink3=false;
    var selectedObj_treasurechest=false;
    var selectedObj_carpet1=false;
    var selectedObj_carpet2=false;
    var selectedObj_lampbathroom=false;
    var selectedObj_clothesrack1=false;
    var selectedObj_treasurechest2=false;
    var selectedObj_nightstand1=false;
    var selectedObj_nightstand2=false;


    document.onkeydown = function(evt) {
      if (evt.keyCode == 27) {
	      selectedObj_clothesrack1= false;
        clothesrack1_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
	      selectedObj_smalltable= false;
        smalltable_mesh.material.color = new THREE.Color(1, 1, 1);
	      selectedObj_lampbathroom= false;
        lampbathroom_mesh.material.color = new THREE.Color(1, 0.8, 0);
	      selectedObj_carpet2= false;
        carpet2_mesh.material.color = new THREE.Color(0, 0.75, 0.65);
	      selectedObj_carpet1 = false;
        carpet1_mesh.material.color = new THREE.Color(0, 0.75, 0.65);
	      selectedObj_bathtube1 = false;
        bathtube1_mesh.material.color = new THREE.Color(0, 0.75, 0.65);
	      selectedObj_toilet1 = false;
        toilet1_mesh.material.color = new THREE.Color(1, 1, 1);
	      selectedObj_sink3 = false;
        sink3_mesh.material.color = new THREE.Color(0.5, 0.5, 0.5);
	      selectedObj_treasurechest = false;
        treasurechest_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
	      selectedObj_treasurechest2 = false;
        treasurechest2_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
        selectedObj_bed = false;
        bed_mesh.material.color = new THREE.Color(1, 1, 1);
        selectedObj_car = false;
        car_mesh.material.color = new THREE.Color(0.6,0,0);
        selectedObj_shelf = false;
        shelf_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
	      selectedObj_bookshelf = false;
        bookshelf_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
	      selectedObj_bookshelf2= false;
        bookshelf2_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
        selectedObj_fridge = false;
        fridge_mesh.material.color = new THREE.Color(1, 1, 1);
        selectedObj_lamp = false;
        lamp_mesh.material.color = new THREE.Color(1, 0.8, 0);
        selectedObj_dishwasher = false;
        dishwasher_mesh.material.color = new THREE.Color(0.5, 0.5, 0.5);
        selectedObj_sink= false;
        sink_mesh.material.color = new THREE.Color(0.5, 0.5, 0.5);
        selectedObj_stove= false;
        stove_mesh.material.color = new THREE.Color(0.5, 0.5, 0.5);
        selectedObj_table = false;
        table_mesh.material.color = new THREE.Color(0, 0.75, 0.65);
        selectedObj_chair_1 = false;
        chair_mesh_1.material.color = new THREE.Color(1, 1, 1);
        selectedObj_chair_2 = false;
        chair_mesh_2.material.color = new THREE.Color(1, 1, 1);
	      selectedObj_fancychair1 = false;
        fancychair1_mesh.material.color = new THREE.Color(1, 0.647, 0);
        selectedObj_fancychair2 = false;
        fancychair2_mesh.material.color = new THREE.Color(1, 0.647, 0);
        selectedObj_lamp_1 = false;
        lamp_mesh_1.material.color = new THREE.Color(1, 0.8, 0);
        selectedObj_tv = false;
        tv_mesh.material.color = new THREE.Color(0.5, 0.5, 0.5);
        selectedObj_painting = false;
        painting_mesh.material.color = new THREE.Color(0.8, 0.5, 0.8);
	      selectedObj_nightstand1 = false;
        nightstand1_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
	      selectedObj_nightstand2 = false;
        nightstand2_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
      }
    };


    function onDocumentMouseDown(event) {

      var mouse = new THREE.Vector2;
      mouse.x = (event.clientX / renderer.domElement.clientWidth) * 2 - 1;
      mouse.y = - (event.clientY / renderer.domElement.clientHeight) * 2 + 1;

      raycaster.setFromCamera(mouse, camera);

      var intersects = raycaster.intersectObjects(scene.children, false);

      if (intersects.length > 0) {
        //Bed selector

        if ((intersects[0].object.name == "loaded_mesh") && (!selectedObj_bed)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_bed = true;
        }
        if ((intersects[0].object.name != "loaded_mesh") && (selectedObj_bed)) {
          bed_mesh.material.color = new THREE.Color(1, 1, 1);
          var pos = intersects[0].point;
          console.log("Item placed");
          bed_mesh.position.x = pos.x;
          bed_mesh.position.z = pos.z;
          selectedObj_bed = false;
        }

        //Car selector

        if ((intersects[0].object.name == "loaded_mesh_1") && (!selectedObj_car)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_car = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_1") && (selectedObj_car)) {
          car_mesh.material.color = new THREE.Color(0.6,0,0);
          var pos = intersects[0].point;
          console.log("Item placed");
          car_mesh.position.x = pos.x;
          car_mesh.position.z = pos.z;
          selectedObj_car = false;
        }

        //Shelf selector

        if ((intersects[0].object.name == "loaded_mesh_2") && (!selectedObj_shelf)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_shelf = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_2") && (selectedObj_shelf)) {
          shelf_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
          var pos = intersects[0].point;
          console.log("Item placed");
          shelf_mesh.position.x = pos.x;
          shelf_mesh.position.z = pos.z;
          selectedObj_shelf = false;
        }

	   //bookshelf extraroom selector

        if ((intersects[0].object.name == "loaded_mesh_0") && (!selectedObj_bookshelf)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_bookshelf = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_O") && (selectedObj_bookshelf)) {
          bookshelf_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
          var pos = intersects[0].point;
          console.log("Item placed");
          bookshelf_mesh.position.x = pos.x;
          bookshelf_mesh.position.z = pos.z;
          selectedObj_bookshelf = false;
        }

	    //bookshelf2 bedroom selector

        if ((intersects[0].object.name == "loaded_mesh_U") && (!selectedObj_bookshelf2)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_bookshelf2 = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_U") && (selectedObj_bookshelf2)) {
          bookshelf2_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
          var pos = intersects[0].point;
          console.log("Item placed");
          bookshelf2_mesh.position.x = pos.x;
          bookshelf2_mesh.position.z = pos.z;
          selectedObj_bookshelf2 = false;
        }

        //Fridge selector

        if ((intersects[0].object.name == "loaded_mesh_3") && (!selectedObj_fridge)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_fridge = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_3") && (selectedObj_fridge)) {
          fridge_mesh.material.color = new THREE.Color(1, 1, 1);
          var pos = intersects[0].point;
          console.log("Item placed");
          fridge_mesh.position.x = pos.x;
          fridge_mesh.position.z = pos.z;
          selectedObj_fridge = false;
        }

	   //Dishwasher selector

        if ((intersects[0].object.name == "loaded_mesh_A") && (!selectedObj_dishwasher)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_dishwasher = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_A") && (selectedObj_dishwasher)) {
          dishwasher_mesh.material.color = new THREE.Color(0.5,0.5,0.5);
          var pos = intersects[0].point;
          console.log("Item placed");
          dishwasher_mesh.position.x = pos.x;
          dishwasher_mesh.position.z = pos.z;
          selectedObj_dishwasher = false;
        }

	   //Sink selector

        if ((intersects[0].object.name == "loaded_mesh_B") && (!selectedObj_sink)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_sink = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_B") && (selectedObj_sink)) {
          sink_mesh.material.color = new THREE.Color(0.5,0.5,0.5);
          var pos = intersects[0].point;
          console.log("Item placed");
          sink_mesh.position.x = pos.x;
          sink_mesh.position.z = pos.z;
          selectedObj_sink= false;
        }

	    //Stove selector

        if ((intersects[0].object.name == "loaded_mesh_C") && (!selectedObj_stove)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_stove= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_C") && (selectedObj_stove)) {
          stove_mesh.material.color = new THREE.Color(0.5,0.5,0.5);
          var pos = intersects[0].point;
          console.log("Item placed");
          stove_mesh.position.x = pos.x;
          stove_mesh.position.z = pos.z;
          selectedObj_stove= false;
        }

	   //aboveoven1 selector

         if ((intersects[0].object.name == "loaded_mesh_Z") && (!selectedObj_aboveoven1)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_aboveoven1= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_Z") && (selectedObj_aboveoven1)) {
         aboveoven1_mesh.material.color = new THREE.Color(0.5,0.5,0.5);
          var pos = intersects[0].point;
          console.log("Item placed");
          aboveoven1_mesh.position.x = pos.x;
          aboveoven1_mesh.position.z = pos.z;
          selectedObj_aboveoven1= false;
        }

	   //cabinet1 selector

        if ((intersects[0].object.name == "loaded_mesh_D") && (!selectedObj_cabinet1)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_cabinet1= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_D") && (selectedObj_cabinet1)) {
          cabinet1_mesh.material.color = new THREE.Color(0.5,0.5,0.5);
          var pos = intersects[0].point;
          console.log("Item placed");
          cabinet1_mesh.position.x = pos.x;
          cabinet1_mesh.position.z = pos.z;
          selectedObj_cabinet1= false;
        }

	   //cabinet2 selector

        if ((intersects[0].object.name == "loaded_mesh_E") && (!selectedObj_cabinet2)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_cabinet2= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_E") && (selectedObj_cabinet2)) {
          cabinet2_mesh.material.color = new THREE.Color(0.5,0.5,0.5);
          var pos = intersects[0].point;
          console.log("Item placed");
          cabinet2_mesh.position.x = pos.x;
          cabinet2_mesh.position.z = pos.z;
          selectedObj_cabinet2= false;
        }


	  //bathtube1 selector

        if ((intersects[0].object.name == "loaded_mesh_F") && (!selectedObj_bathtube1)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_bathtube1= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_F") && (selectedObj_bathtube1)) {
          bathtube1_mesh.material.color = new THREE.Color(0, 0.75, 0.65);
          var pos = intersects[0].point;
          console.log("Item placed");
          bathtube1_mesh.position.x = pos.x;
          bathtube1_mesh.position.z = pos.z;
          selectedObj_bathtube1= false;
        }

	  //sink3 selector

        if ((intersects[0].object.name == "loaded_mesh_G") && (!selectedObj_sink3)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_sink3= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_G") && (selectedObj_sink3)) {
          sink3_mesh.material.color = new THREE.Color(0.5,0.5,0.5);
          var pos = intersects[0].point;
          console.log("Item placed");
          sink3_mesh.position.x = pos.x;
          sink3_mesh.position.z = pos.z;
          selectedObj_sink3= false;
        }

	   //toilet1 selector

        if ((intersects[0].object.name == "loaded_mesh_H") && (!selectedObj_toilet1)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_toilet1= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_H") && (selectedObj_toilet1)) {
          toilet1_mesh.material.color = new THREE.Color(1, 1, 1);
          var pos = intersects[0].point;
          console.log("Item placed");
          toilet1_mesh.position.x = pos.x;
          toilet1_mesh.position.z = pos.z;
          selectedObj_toilet1= false;
        }

	  //treasurechest bathroom selector

        if ((intersects[0].object.name == "loaded_mesh_I") && (!selectedObj_treasurechest)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_treasurechest= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_I") && (selectedObj_treasurechest)) {
          treasurechest_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
          var pos = intersects[0].point;
          console.log("Item placed");
          treasurechest_mesh.position.x = pos.x;
          treasurechest_mesh.position.z = pos.z;
          selectedObj_treasurechest= false;
        }

	  //treasurechest2 bedroom selector

        if ((intersects[0].object.name == "loaded_mesh_N") && (!selectedObj_treasurechest2)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_treasurechest2= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_N") && (selectedObj_treasurechest2)) {
          treasurechest2_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
          var pos = intersects[0].point;
          console.log("Item placed");
          treasurechest2_mesh.position.x = pos.x;
          treasurechest2_mesh.position.z = pos.z;
          selectedObj_treasurechest2= false;
        }

	  //nightstand1 bedroom selector

        if ((intersects[0].object.name == "loaded_mesh_S") && (!selectedObj_nightstand1)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_nightstand1= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_S") && (selectedObj_nightstand1)) {
          nightstand1_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
          var pos = intersects[0].point;
          console.log("Item placed");
          nightstand1_mesh.position.x = pos.x;
          nightstand1_mesh.position.z = pos.z;
          selectedObj_nightstand1= false;
        }

	  //nightstand2 bedroom selector

        if ((intersects[0].object.name == "loaded_mesh_T") && (!selectedObj_nightstand2)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_nightstand2= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_T") && (selectedObj_nightstand2)) {
          nightstand2_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
          var pos = intersects[0].point;
          console.log("Item placed");
          nightstand2_mesh.position.x = pos.x;
          nightstand2_mesh.position.z = pos.z;
          selectedObj_nightstand2= false;
        }

	   //carpet1 selector

        if ((intersects[0].object.name == "loaded_mesh_J") && (!selectedObj_carpet1)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_carpet1= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_J") && (selectedObj_carpet1)) {
          carpet1_mesh.material.color = new THREE.Color(0,1,1);
          var pos = intersects[0].point;
          console.log("Item placed");
          carpet1_mesh.position.x = pos.x;
          carpet1_mesh.position.z = pos.z;
          selectedObj_carpet1= false;
        }

	  //carpet2 selector

        if ((intersects[0].object.name == "loaded_mesh_K") && (!selectedObj_carpet2)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_carpet2= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_K") && (selectedObj_carpet2)) {
          carpet2_mesh.material.color = new THREE.Color(0,1,1);
          var pos = intersects[0].point;
          console.log("Item placed");
          carpet2_mesh.position.x = pos.x;
          carpet2_mesh.position.z = pos.z;
          selectedObj_carpet2= false;
        }

	    //lampbathroom selector

        if ((intersects[0].object.name == "loaded_mesh_L") && (!selectedObj_lampbathroom)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_lampbathroom = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_L") && (selectedObj_lampbathroom)) {
          lampbathroom_mesh.material.color = new THREE.Color(1, 0.8, 0);
          var pos = intersects[0].point;
          console.log("Item placed");
          lampbathroom_mesh.position.x = pos.x;
          lampbathroom_mesh.position.z = pos.z;
          selectedObj_lampbathroom = false;
        }

	  //clothesrack1 selector

        if ((intersects[0].object.name == "loaded_mesh_M") && (!selectedObj_clothesrack1)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_clothesrack1= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_M") && (selectedObj_clothesrack1)) {
          clothesrack1_mesh.material.color = new THREE.Color(0.6, 0.3, 0.2);
          var pos = intersects[0].point;
          console.log("Item placed");
          clothesrack1_mesh.position.x = pos.x;
          clothesrack1_mesh.position.z = pos.z;
          selectedObj_clothesrack1= false;
        }

        //Lamp selector

        if ((intersects[0].object.name == "loaded_mesh_4") && (!selectedObj_lamp)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_lamp = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_4") && (selectedObj_lamp)) {
          lamp_mesh.material.color = new THREE.Color(1, 0.8, 0);
          var pos = intersects[0].point;
          console.log("Item placed");
          lamp_mesh.position.x = pos.x;
          lamp_mesh.position.z = pos.z;
          selectedObj_lamp = false;
        }

        //Table selector

        if ((intersects[0].object.name == "loaded_mesh_5") && (!selectedObj_table)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_table = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_5") && (selectedObj_table)) {
          table_mesh.material.color = new THREE.Color(0, 0.75, 0.65);
          var pos = intersects[0].point;
          console.log("Item placed");
          table_mesh.position.x = pos.x;
          table_mesh.position.z = pos.z;
          selectedObj_table = false;
        }

	   //smalltable extraroom selector

        if ((intersects[0].object.name == "loaded_mesh_R") && (!selectedObj_smalltable)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_smalltable= true;
        }
        if ((intersects[0].object.name != "loaded_mesh_R") && (selectedObj_smalltable)) {
          smalltable_mesh.material.color = new THREE.Color(1, 1, 1);
          var pos = intersects[0].point;
          console.log("Item placed");
          smalltable_mesh.position.x = pos.x;
          smalltable_mesh.position.z = pos.z;
          selectedObj_smalltable= false;
        }

        //Chair_1 selector

        if ((intersects[0].object.name == "loaded_mesh_6") && (!selectedObj_chair_1)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_chair_1 = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_6") && (selectedObj_chair_1)) {
          chair_mesh_1.material.color = new THREE.Color(1, 1, 1);
          var pos = intersects[0].point;
          console.log("Item placed");
          chair_mesh_1.position.x = pos.x;
          chair_mesh_1.position.z = pos.z;
          selectedObj_chair_1 = false;
        }

        //Chair_2 selector

        if ((intersects[0].object.name == "loaded_mesh_7") && (!selectedObj_chair_2)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_chair_2 = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_7") && (selectedObj_chair_2)) {
          chair_mesh_2.material.color = new THREE.Color(1, 1, 1);
          var pos = intersects[0].point;
          console.log("Item placed");
          chair_mesh_2.position.x = pos.x;
          chair_mesh_2.position.z = pos.z;
          selectedObj_chair_2 = false;
        }

	   //fancychair1 extraroom selector

        if ((intersects[0].object.name == "loaded_mesh_P") && (!selectedObj_fancychair1)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_fancychair1 = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_P") && (selectedObj_fancychair1)) {
          fancychair1_mesh.material.color = new THREE.Color(1, 0.647, 0);
          var pos = intersects[0].point;
          console.log("Item placed");
          fancychair1_mesh.position.x = pos.x;
          fancychair1_mesh.position.z = pos.z;
          selectedObj_fancychair1 = false;
        }

        //fancychair2 selector

        if ((intersects[0].object.name == "loaded_mesh_Q") && (!selectedObj_fancychair2)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_fancychair2 = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_Q") && (selectedObj_fancychair2)) {
         fancychair2_mesh.material.color = new THREE.Color(1, 0.647, 0);
          var pos = intersects[0].point;
          console.log("Item placed");
          fancychair2_mesh.position.x = pos.x;
          fancychair2_mesh.position.z = pos.z;
          selectedObj_fancychair2 = false;
        }

        //Lamp_1 selector

        if ((intersects[0].object.name == "loaded_mesh_8") && (!selectedObj_lamp_1)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_lamp_1 = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_8") && (selectedObj_lamp_1)) {
          lamp_mesh_1.material.color = new THREE.Color(1, 0.8, 0);
          var pos = intersects[0].point;
          console.log("Item placed");
          lamp_mesh_1.position.x = pos.x;
          lamp_mesh_1.position.z = pos.z;
          selectedObj_lamp_1 = false;
        }

        //TV selector

        if ((intersects[0].object.name == "loaded_mesh_9") && (!selectedObj_tv)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_tv = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_9") && (selectedObj_tv)) {
          tv_mesh.material.color = new THREE.Color(0.5, 0.5, 0.5);
          var pos = intersects[0].point;
          console.log("Item placed");
          tv_mesh.position.x = pos.x;
          tv_mesh.position.z = pos.z;
          selectedObj_tv = false;
        }

        //Painting selector

        if ((intersects[0].object.name == "loaded_mesh_10") && (!selectedObj_painting)) {
          console.log("Item selected");
          intersects[0].object.material.color = new THREE.Color(1, 0.5, 0.5);
          selectedObj_painting = true;
        }
        if ((intersects[0].object.name != "loaded_mesh_10") && (selectedObj_painting)) {
          painting_mesh.material.color = new THREE.Color(0.8, 0.5, 0.8);
          var pos = intersects[0].point;
          console.log("Item placed");
          painting_mesh.position.x = pos.x;
          painting_mesh.position.z = pos.z;
          selectedObj_painting = false;
        }

      }
    }

    function buildWalls() {
      var basicTextureUri = 'http://localhost:8000/img/txtr_white_wall.jpg';

      var wall_bottom_out = new THREE.Mesh(geometry_wall_parallel_out, loadTexture(basicTextureUri, 1, WallSideEnum.front));
      wall_bottom_out.position.y += (geometry_wall_parallel.parameters.height / 2);
      wall_bottom_out.position.z += FLOOR_LENGTH / 2 - geometry_wall_parallel.parameters.depth / 2;
      scene.add(wall_bottom_out);

      var wallMaterial = loadTexture(basicTextureUri, 1, WallSideEnum.back);
      wallMaterial[WallSideEnum.front] = createTextureMaterial('http://localhost:8000/img/wand_pattern.jpg', 1);
      var wall_top_out =  new THREE.Mesh(geometry_wall_parallel_04, wallMaterial);
      wall_top_out.position.y+=(geometry_wall_parallel.parameters.height/2);
      wall_top_out.position.z-=FLOOR_LENGTH/2 - geometry_wall_parallel.parameters.depth/2;
      scene.add(wall_top_out);

      var wall_left_out =  new THREE.Mesh(geometry_wall_orthogonal_08, loadTexture(basicTextureUri, 1, WallSideEnum.left));
      wall_left_out.position.y+=(geometry_wall_orthogonal.parameters.height/2);
      wall_left_out.position.x-=FLOOR_WIDTH/2 - geometry_wall_orthogonal.parameters.width/2;
      wall_left_out.position.z+=FLOOR_LENGTH/2*(1-WALL_RIGHT_LENGTH) - OFFSET;
      scene.add(wall_left_out);

      var wall_right_out =  new THREE.Mesh(geometry_wall_orthogonal_08, loadTexture(basicTextureUri, 1, WallSideEnum.right));
      wall_right_out.position.y += (geometry_wall_orthogonal.parameters.height / 2);
      wall_right_out.position.x += FLOOR_WIDTH / 2 - geometry_wall_orthogonal.parameters.width / 2;
      wall_right_out.position.z += FLOOR_LENGTH / 2 * (1 - WALL_RIGHT_LENGTH) - OFFSET;
      scene.add(wall_right_out);

      var wall_bottom_10 =  new THREE.Mesh(geometry_wall_parallel, loadTexture(basicTextureUri, 1, WallSideEnum.none));
      wall_bottom_10.position.y += (geometry_wall_parallel.parameters.height / 2);
      wall_bottom_10.position.z += FLOOR_LENGTH / 2 - geometry_wall_parallel.parameters.depth / 2 - FLOOR_LENGTH * 0.2;
      scene.add(wall_bottom_10);

      wallMaterial = loadTexture(basicTextureUri, 1, WallSideEnum.none);
      wallMaterial[WallSideEnum.front] = createTextureMaterial('http://localhost:8000/img/wall_pisa.jpg', 1);
      var wall_top_left =  new THREE.Mesh(geometry_wall_parallel_03, wallMaterial);
      wall_top_left.position.y+=(geometry_wall_parallel.parameters.height/2);
      wall_top_left.position.x-=FLOOR_WIDTH/2*(1-WALL_TOP_WIDTH) - OFFSET;
      wall_top_left.position.z-=FLOOR_LENGTH/2-FLOOR_LENGTH*(1-WALL_LEFT_LENGTH) - geometry_wall_parallel.parameters.depth/2;
      scene.add(wall_top_left);

      var wall_top_right=  new THREE.Mesh(geometry_wall_parallel_02, loadTexture(basicTextureUri, 1, WallSideEnum.none));
      wall_top_right.position.y+=(geometry_wall_parallel.parameters.height/2);
      wall_top_right.position.x+=FLOOR_WIDTH/2*(1-0.25) + 1.8 - OFFSET;
      wall_top_right.position.z-=FLOOR_LENGTH/2-FLOOR_LENGTH*(1-WALL_LEFT_LENGTH) - geometry_wall_parallel.parameters.depth/2 - 12;
      scene.add(wall_top_right);

      var wall_left_04 =  new THREE.Mesh(geometry_wall_orthogonal_04, loadTexture(basicTextureUri, 1, WallSideEnum.none));
      wall_left_04.position.y+=(geometry_wall_orthogonal.parameters.height/2);
      wall_left_04.position.x-=FLOOR_WIDTH/2-FLOOR_WIDTH/2*(1-WALL_TOP_WIDTH) - 2;
      wall_left_04.position.z+=FLOOR_LENGTH/2*(1-WALL_LEFT_LENGTH) - FLOOR_LENGTH*0.1 - OFFSET;
      scene.add(wall_left_04);

      var wall_left_02 =  new THREE.Mesh( geometry_wall_orthogonal_02, loadTexture(basicTextureUri, 1, WallSideEnum.none));
      wall_left_02.position.y+=(geometry_wall_orthogonal.parameters.height/2);
      wall_left_02.position.x-=FLOOR_WIDTH/2-FLOOR_WIDTH/2*(1-WALL_TOP_WIDTH) + 6;
      wall_left_02.position.z+=FLOOR_LENGTH/2 - geometry_wall_parallel.parameters.depth/2 - (FLOOR_LENGTH*0.2)/2;
      scene.add(wall_left_02);

      var wall_right_02 =  new THREE.Mesh(geometry_wall_orthogonal_02, loadTexture(basicTextureUri, 1, WallSideEnum.none));
      wall_right_02.position.y+=(geometry_wall_orthogonal.parameters.height/2);
      wall_right_02.position.x+=FLOOR_WIDTH/2-FLOOR_WIDTH/2*(1-WALL_TOP_WIDTH) + 5 ;
      wall_right_02.position.z+=FLOOR_LENGTH/2 - geometry_wall_parallel.parameters.depth/2 - (FLOOR_LENGTH*0.2)/2;
      scene.add(wall_right_02);

      var wall_diagonaltop_right =  new THREE.Mesh(geometry_wall_diagonal, loadTexture(basicTextureUri, 1, WallSideEnum.right));
      var rot = new THREE.Matrix4();
      rot.makeRotationY(0.8);
      wall_diagonaltop_right.applyMatrix(rot);
      wall_diagonaltop_right.position.y+=(geometry_wall_orthogonal.parameters.height/2);
      wall_diagonaltop_right.position.x+=FLOOR_WIDTH/2-FLOOR_WIDTH/2*(1-WALL_TOP_WIDTH) + 14.5 ;
      wall_diagonaltop_right.position.z-=FLOOR_LENGTH/2 - geometry_wall_parallel.parameters.depth/2 - (FLOOR_LENGTH*0.2)/2 + OFFSET;
      scene.add(wall_diagonaltop_right);

      var wall_diagonaltop_left =  new THREE.Mesh(geometry_wall_diagonal, loadTexture(basicTextureUri, 1, WallSideEnum.left));
      var rot = new THREE.Matrix4();
      rot.makeRotationY(-0.8);
      wall_diagonaltop_left.applyMatrix(rot);
      wall_diagonaltop_left.position.y+=(geometry_wall_orthogonal.parameters.height/2);
      wall_diagonaltop_left.position.x-=FLOOR_WIDTH/2-FLOOR_WIDTH/2*(1-WALL_TOP_WIDTH) + 14.5 ;
      wall_diagonaltop_left.position.z-=FLOOR_LENGTH/2 - geometry_wall_parallel.parameters.depth/2 - (FLOOR_LENGTH*0.2)/2 + OFFSET;
      scene.add(wall_diagonaltop_left);
    }

    var livingroom_light;
    var bedroom_light;
    var bathroom_light;
    function addLighting() {
      livingroom_light = new THREE.PointLight(new THREE.Color(1, 1, 1), (1), (150) ,2);
      livingroom_light.position.set(5, 13, 0);
      scene.add(livingroom_light);

      bedroom_light = new THREE.PointLight(new THREE.Color(1, 1, 1), (1), (150) ,2);
      bedroom_light.position.set(-10, 13, 0);
      scene.add(bedroom_light);

	bathroom_light = new THREE.PointLight(new THREE.Color(1, 1, 1), (1), (150) ,2);
      bathroom_light.position.set(-3, 13, 43);
      scene.add(bathroom_light);
    }

    var gui;
    function buildGui() {
       gui = new dat.GUI();
       var params = {
         cameralight_intensity: cameraLight.intensity,
         livingroom_light: livingroom_light.intensity,
         bedroom_light: bedroom_light.intensity,
	   bathroom_light:bathroom_light.intensity,
         turn_off_lights: false
       }
       gui.add( params, 'cameralight_intensity', 0, 3 ).onChange( function ( val ) {
         cameraLight.intensity=val;
       } );
       gui.add( params, 'livingroom_light', 0, 3 ).onChange( function ( val ) {
         livingroom_light.intensity=val;
       } );
       gui.add( params, 'bedroom_light', 0, 3 ).onChange( function ( val ) {
         bedroom_light.intensity=val;
       } );
	  gui.add( params, 'bathroom_light', 0, 3 ).onChange( function ( val ) {
         bathroom_light.intensity=val;
       } );
       gui.add( params, 'turn_off_lights', 0, 3 ).onChange( function ( val ) {
         livingroom_light.intensity=!val;
         bedroom_light.intensity=!val;
	   bathroom_light.intensity=!val;

       } );

       //TODO Add Texture Changer

       gui.open();
     }

    //This allows to capture the clicks of the mouse for moving elements
    document.addEventListener('mousedown', onDocumentMouseDown, false);

    buildGui();

  </script>

</body>

</html>
